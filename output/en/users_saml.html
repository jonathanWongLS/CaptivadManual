<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Xibo Documentation</title>
        <meta name="viewport" content="width=device-width">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <!-- favicon -->
        <link href="../img/favicon.ico" rel="shortcut icon"/>

        <!-- Bootstrap -->
        <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
        
        <!-- Stylesheets -->
        <link href="../manual.css" rel="stylesheet" media="screen">
        
        <!-- META -->
        <meta name="keywords" content="digital signage, signage, narrow-casting, captivad, open source, agpl, documentation" />
        <meta name="description" content="Captivad is an open source digital signage solution. It supports all main media types and can be interfaced to other sources of data using CSV, Databases or RSS." />
    </head>
    <body data-toc="users">
        
        <nav id="top-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#ss-navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="#" class="navbar-brand">Xibo Documentation</a>
                </div>
            
                <div class="collapse navbar-collapse" id="ss-navbar">
                    <ul class="nav navbar-nav">

                    </ul>
                </div>
            </div>
        </nav>

        <div class="ss_body container">
            <div class="row">
                <div class="col-md-3">
                    <ul id="side-nav" class="nav nav-pills nav-stacked">
                        <!-- <li><a href="index.html" data-toc-name="getting_started">Getting Started</a></li> -->
<li><a href="index.html" data-toc-name="tour">Tour</a></li><li><a href="displays.html" data-toc-name="displays">Displays</a></li><li><a href="layouts.html" data-toc-name="layouts">Layouts</a></li><li><a href="media.html" data-toc-name="media">Library</a></li><li><a href="scheduling.html" data-toc-name="scheduling">Scheduling</a></li><li><a href="users.html" data-toc-name="users">Users</a></li><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><ul>
<li><a href="users.html">Introduction</a></li>
<li><a href="users_administration.html">Users</a></li>
<li><a href="users_user_types.html">Types</a></li>
<li><a href="users_groups.html">Groups</a></li>
<li><a href="users_library_quota.html">Library Quota</a></li>
<li><a href="users_permissions.html">Permissions</a></li>
<li><a href="users_notifications.html">Notifications</a></li>
<li class="active"><a href="users_saml.html">SAML<span class="glyphicon glyphicon-arrow-left you-are-here-arrow"></span></a></li>
</ul></body></html>
<li><a href="advanced.html" data-toc-name="advanced">Advanced</a></li>
                    </ul>
                </div>
                <div class="col-md-9" role="main">
                    <!--toc=users-->
<h1 id="saml">SAML <a href="#saml" class="header-link"></a></h1>
<p>The CMS can be configured to use SAML as its authentication provider. </p>
<blockquote>
<p>Security Assertion Markup Language (SAML, pronounced sam-el) is an XML-based, open-standard data format for
exchanging authentication and authorization data between parties, in particular, between an identity provider
and a service provider.</p>
<ul>
<li>Wikipedia</li>
</ul>
</blockquote>
<p>SAML integration is enabled via the <code>settings.php</code> file in the CMS installation - at a later date a GUI may be
provided. If Docker has been used <code>settings.php</code> will not be accessible, however it is possible to create a
<code>settings-custom.php</code> file in the <code>/custom</code> mount point. The below configuration can be added to that file instead.</p>
<p>The purpose of the integration is to configure a SAML enabled IdP (identity provider) for authentication with the
Xibo CMS.</p>
<p>A user already authenticated with the IdP will automatically be logged into the CMS. If the user does not exist they
will optionally be created with a set of default credentials.</p>
<h2 id="configuration">Configuration <a href="#configuration" class="header-link"></a></h2>
<p>SAML integration is configured in the <code>settings.php</code> file of the CMS installation. This file can be found in your
<code>/web</code> folder.</p>
<p>There are two sections to adjust, the <code>$authentication</code> middleware and the <code>$samlSettings</code> configuration array.</p>
<h3>Middleware</h3>
<p>The authentication middleware should be changed to <code>SAMLAuthentication</code>, shown below:</p>
<pre><code class="language-php">$authentication = new \Xibo\Middleware\SAMLAuthentication();</code></pre>
<h3>SAML Settings</h3>
<p>The SAML settings array contains all the necessary information for the CMS to connect and use a SAML enabled IdP. An
example settings file can be seen below.</p>
<p>The workflow section of the configuration is used to determine the mapping between the IdP and the CMS and whether
the CMS allows JIT provisioning. With JIT provisioning enabled users that visit the CMS who do not currently have
an account are automatically created.</p>
<p>If <em>single logout</em> is disabled selecting logout in the CMS won't have any effect as the user will be immediately
logged in again on the next request.</p>
<p>Further explanation of the SAML specific settings can be found at: <a href="https://github.com/onelogin/php-saml#settings">https://github.com/onelogin/php-saml#settings</a></p>
<pre><code class="language-php">$samlSettings = array (
   'workflow' =&gt; array(
        // Enable/Disable Just-In-Time provisioning
        'jit' =&gt; true,
        // Attribute to identify the user 
        'field_to_identify' =&gt; 'UserName',   // Alternatives: UserID, UserName or email
        // Default libraryQuota assigned to the created user by JIT
        'libraryQuota' =&gt; 1000,
        // Initial User Group
        'group' =&gt; 'Users',
        // Home Page
        'homePage' =&gt; 'dashboard',
        // Enable/Disable Single Logout
        'slo' =&gt; true,
        // Attribute mapping between XIBO-CMS and the IdP
        'mapping' =&gt; array (
            'UserID' =&gt; '',
            'usertypeid' =&gt; '',
            'UserName' =&gt; 'uid',
            'email' =&gt; 'mail',
            'ref1' =&gt; '',
            'ref2' =&gt; '',
            'ref3' =&gt; '',
            'ref4' =&gt; '',
            'ref5' =&gt; ''
        )
    ),
   // Settings for the PHP-SAML toolkit. 
   // See documentation: https://github.com/onelogin/php-saml#settings 
   'strict' =&gt; false,
   'debug' =&gt; true,
   'idp' =&gt; array (
            'entityId' =&gt; 'https://idp.example.com/simplesaml/saml2/idp/metadata.php',
            'singleSignOnService' =&gt; array (
                'url' =&gt; 'http://idp.example.com/simplesaml/saml2/idp/SSOService.php',
            ),
            'singleLogoutService' =&gt; array (
                'url' =&gt; 'http://idp.example.com/simplesaml/saml2/idp/SingleLogoutService.php',
            ),
            'x509cert' =&gt; 'MIICbDCCAdWgAwIBAgIBADANBgkqhkiG9w0BAQ0FADBTMQswCQYDVQQGEwJ1czETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UECgwMT25lbG9naW4gSW5jMRgwFgYDVQQDDA9pZHAuZXhhbXBsZS5jb20wHhcNMTQwOTIzMTIyNDA4WhcNNDIwMjA4MTIyNDA4WjBTMQswCQYDVQQGEwJ1czETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UECgwMT25lbG9naW4gSW5jMRgwFgYDVQQDDA9pZHAuZXhhbXBsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOWA+YHU7cvPOrBOfxCscsYTJB+kH3MaA9BFrSHFS+KcR6cw7oPSktIJxUgvDpQbtfNcOkE/tuOPBDoech7AXfvH6d7Bw7xtW8PPJ2mB5Hn/HGW2roYhxmfh3tR5SdwN6i4ERVF8eLkvwCHsNQyK2Ref0DAJvpBNZMHCpS24916/AgMBAAGjUDBOMB0GA1UdDgQWBBQ77/qVeiigfhYDITplCNtJKZTM8DAfBgNVHSMEGDAWgBQ77/qVeiigfhYDITplCNtJKZTM8DAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBDQUAA4GBAJO2j/1uO80E5C2PM6Fk9mzerrbkxl7AZ/mvlbOn+sNZE+VZ1AntYuG8ekbJpJtG1YfRfc7EA9mEtqvv4dhv7zBy4nK49OR+KpIBjItWB5kYvrqMLKBa32sMbgqqUqeF1ENXKjpvLSuPdfGJZA3dNa/+Dyb8GGqWe707zLyc5F8m',
        ),
   'sp' =&gt; array (
        'entityId' =&gt; 'http://xibo-cms.example.com/saml/metadata',
        'assertionConsumerService' =&gt; array (
            'url' =&gt; 'http://xibo-cms.example.com/saml/acs',
        ),
        'singleLogoutService' =&gt; array (
            'url' =&gt; 'http://xibo-cms.example.com/saml/sls',
        ),
        'NameIDFormat' =&gt; 'urn:oasis:names:tc:SAML:2.0:nameid-format:emailAddress',
        'x509cert' =&gt; '',
        'privateKey' &gt; '',
    ),
    'security' =&gt; array (
        'nameIdEncrypted' =&gt; false,
        'authnRequestsSigned' =&gt; false,
        'logoutRequestSigned' =&gt; false,
        'logoutResponseSigned' =&gt; false,
        'signMetadata' =&gt; false,
        'wantMessagesSigned' =&gt; false,
        'wantAssertionsSigned' =&gt; false,
        'wantAssertionsEncrypted' =&gt; false,
        'wantNameIdEncrypted' =&gt; false,
    )
);</code></pre>
                </div>
            </div>
        </div> <!-- container-->
        <footer class="ss_footer" role="contentinfo">
            <div class="container">
                <div class="pull-right">
                    <img class="img-responsive logo" src="../img/logo.png" alt="Captivad" />
                </div>

                <p class="ss_back_to_top">Back to Top</p>

                <p>Designed and built by <a href="http://springsignage.com/">Spring Signage</a> for the <a href="http://www.xibo.org.uk" target="_blank">Xibo Project</a>.</p>
                <p>Open Source Code licensed under <a href="" target="_blank">GNU Affero General Public License v3 or later</a>, documentation under <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.0/uk/" target="_blank">Creative Commons Licence</a>.</p>

                <p class="ss_footer_links">Currently v1.8.4</p>

                <p class="ss_languages"><a href="../en/index.html">en</a> | <a href="../fr/index.html">fr</a></p>
            </div>
        </footer>

        <!-- JavaScript -->
        <script src="../vendor/jquery/jquery-1.9.1.js"></script>
        <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                $(".ss_body img").addClass("img-thumbnail");
                $(".ss_body table").addClass("table");

                // Set the selected page based on the TOC name
                // Mark the appropriate top nav element as the selected page
                $("#side-nav a").each(function() {
                    if ($(this).data().tocName == $("body").data().toc)
                        $(this).parent().addClass("active");
                });

                $(".ss_back_to_top").click(function() {
                    $('html, body').animate({scrollTop : 0},800);
                });

                if (inIframe()) {
                    console.log("In Frame");
                    $("#top-nav").css("display", "none");
                    $(".ss-sidebar").parent().css("display", "none");
                }
            });

            function inIframe () {
                try {
                    return window.self !== window.top;
                } catch (e) {
                    return true;
                }
            }
        </script>
    </body>
</html>
