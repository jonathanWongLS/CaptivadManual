<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Xibo Documentation</title>
        <meta name="viewport" content="width=device-width">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <!-- favicon -->
        <link href="../img/favicon.ico" rel="shortcut icon"/>

        <!-- Bootstrap -->
        <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
        
        <!-- Stylesheets -->
        <link href="../manual.css" rel="stylesheet" media="screen">
        
        <!-- META -->
        <meta name="keywords" content="digital signage, signage, narrow-casting, captivad, open source, agpl, documentation" />
        <meta name="description" content="Captivad is an open source digital signage solution. It supports all main media types and can be interfaced to other sources of data using CSV, Databases or RSS." />
    </head>
    <body data-toc="api">
        
        <nav id="top-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#ss-navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="#" class="navbar-brand">Xibo Documentation</a>
                </div>
            
                <div class="collapse navbar-collapse" id="ss-navbar">
                    <ul class="nav navbar-nav">

                    </ul>
                </div>
            </div>
        </nav>

        <div class="ss_body container">
            <div class="row">
                <div class="col-md-3">
                    <ul id="side-nav" class="nav nav-pills nav-stacked">
                        <!-- <li><a href="index.html" data-toc-name="getting_started">Getting Started</a></li> -->
<li><a href="index.html" data-toc-name="tour">Tour</a></li><li><a href="displays.html" data-toc-name="displays">Displays</a></li><li><a href="layouts.html" data-toc-name="layouts">Layouts</a></li><li><a href="media.html" data-toc-name="media">Library</a></li><li><a href="scheduling.html" data-toc-name="scheduling">Scheduling</a></li><li><a href="users.html" data-toc-name="users">Users</a></li><li><a href="advanced.html" data-toc-name="api">Advanced</a></li><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><ul>
<li><a href="api.html">Overview</a></li>
<li>
<p class="active"><a href="cms_api.html">CMS API<span class="glyphicon glyphicon-arrow-left you-are-here-arrow"></span></a></p>
</li>
<li>
<p><a href="../api/">CMS API Reference</a></p>
</li>
<li><a href="xmds.html">Player API</a></li>
<li><a href="xlf.html">XLF</a></li>
<li><a href="xmr_api.html">XMR</a></li>
</ul></body></html>

                    </ul>
                </div>
                <div class="col-md-9" role="main">
                    <!--toc=api-->
<h1 id="cms_api">CMS API <a href="#cms_api" class="header-link"></a></h1>
<p>The CMS API is a full featured restful API which allows for advanced integrations with other applications and
automation of CMS functionality.</p>
<p>The API enables exciting opportunities to integrate Xibo with other systems. Imagine an integration
with a point of sale system which pushed complimentary products to the signage when a customer purchased something.</p>
<p>Any party connecting to the CMS is considered to be an &quot;application&quot; and is granted credentials according to the
Applications page in the CMS.</p>
<h2 id="authentication">Authentication <a href="#authentication" class="header-link"></a></h2>
<p>Securing the CMS is of utmost importance and the API is secured behind an oAuth resource server which requires
a valid <code>access_token</code> to be provided before access will be granted.</p>
<p>An <code>access_token</code> can be obtained from the CMS Authorization Server.</p>
<p>Once an <code>access_token</code> has been obtained it should be provided with every request using an Authorization header. The
<code>access_token</code>'s are <em>Bearer Tokens</em> and should therefore be provided as such:</p>
<pre><code>Authorization: Bearer &lt;&lt;access token&gt;&gt;</code></pre>
<h3>Client Information</h3>
<p>Applications connecting to the CMS API must do so using a <code>clientId</code> and <code>clientSecret</code> which are available from the
Applications page.</p>
<p>An application needs to be added to the CMS before an authorisation request can be processed. After adding an
Application it can be granted access to two different types of credentials, called grant types.</p>
<h3>Grant Types</h3>
<p>The CMS supports two grant types:</p>
<ul>
<li>access_code</li>
<li>client_credentials</li>
</ul>
<p>The grant type requested must be supplied in the <code>grant_type</code> query parameter whenever requesting a token.</p>
<p>Applications added to the CMS should specify which grant types are allowed to use those client credentials. The
<code>client_credentials</code> grant is typically used for machine-to-machine communication, whereas the <code>access_code</code> grant
type is used to authorise a user.</p>
<h3>Authorization Server</h3>
<p>The CMS authorization server is used to obtain an <code>access_token</code> and can be found at <code>/api/authorize</code>. The
authorization server supports two methods:</p>
<ul>
<li><code>/api/authorize/</code> initiate the <code>access_code</code> grant</li>
<li><code>/api/authorize/access_token</code> obtain a token</li>
</ul>
<h2 id="methods">Methods <a href="#methods" class="header-link"></a></h2>
<p>The Xibo API is <a href="http://swagger.io/">OpenAPI Compliant</a> and the documentation is presented using Swagger-UI
in this manual.  You may also point a Swagger-UI installation to the <code>/swagger.json</code> resource in your CMS instance.</p>
<p><a href="../api/">View the API documentation</a></p>
<h2 id="php_client_implementation">PHP client implementation <a href="#php_client_implementation" class="header-link"></a></h2>
<p>A PHP oAuth client implementation has been provided for ease of authentication with the API. It can be found here:
<a href="https://github.com/xibosignage/oauth2-xibo-cms">https://github.com/xibosignage/oauth2-xibo-cms</a>.</p>
<h2 id="enveloping">Enveloping <a href="#enveloping" class="header-link"></a></h2>
<p>All requests can be enveloped by adding <code>envelope=1</code> as a query parameter.</p>
<h2 id="errors">Errors <a href="#errors" class="header-link"></a></h2>
<p>API errors are reported via the 4xx and 5xx HTTP response codes, the most common of which are:</p>
<ul>
<li>404 Not Found (the resource could not be found)</li>
<li>409 Conflict (the request conflicts with an existing entity)</li>
<li>422 Unprocessable Entity (the entity provided is invalid)</li>
</ul>
<p>Extra information is available in the response body and is JSON formatted. A human readable
error message is presented, the HTTP status code and a data block indicating further information.</p>
<p>An example 422 response is below:</p>
<pre><code>{
    "error": {
        "message": "Layout Name must be between 1 and 50 characters",
        "code": 422,
        "data": {
            "property": "name"
        }
    }
}</code></pre>
<p>5xx errors indicate an issue with the CMS environment and extra information will be available
in the CMS logs.</p>
<h2 id="grid_data_-_lists_of_records">Grid Data - lists of records <a href="#grid_data_-_lists_of_records" class="header-link"></a></h2>
<p>Lists of records, henceforth referred to as grids, are paged by default, with a default page size of 10 records. They
also have a default sort order applied to them, which is appropriate for that record type.</p>
<h3>Paging</h3>
<p>Paging is controlled by 2 parameters, <code>start</code> and <code>length</code>. The <code>start</code> parameter denotes at which record in the set
the results should start from, and <code>length</code> denotes the number of records to return. The default <code>length</code> is 10 records
which means to get page 2, <code>start=20</code> would be provided.</p>
<p>The headers of the response contain extra information related to paging, these are:</p>
<ul>
<li><code>X-Total-Count</code>: The total count of records (all pages)</li>
<li><code>Link</code>: Links pointing to the first, prev, next and last pages (as appropriate)</li>
</ul>
<p>The link header is <a href="http://tools.ietf.org/html/rfc5988">RFC formatted</a> and consists of a url and <code>;</code> and a <code>rel=</code>
(relationship) attribute.</p>
<p>For example, the headers returned with page 1 are:</p>
<pre><code>Link: &lt;http://localhost/api/layout?start=20&amp;length=10&gt;; rel="next", &lt;http://localhost/api/layout?start=0&amp;length=10&gt;; rel="first"
X-Total-Count: 26</code></pre>
<h3>Sorting</h3>
<p>Sorting happens in two steps using a columns array and an order array. The columns array describes the fields that
should be ordered, and the order array describes how they should be ordered and in what order.</p>
<p>Taking the layout grid as an example, lets imagine we want to order by the <code>duration</code> of the layout, descending. We do
this by specifying a columns array:</p>
<pre><code>columns[1][data]:duration</code></pre>
<p>And an order array:</p>
<pre><code>order[1][column]:1
order[1][dir]:desc</code></pre>
                </div>
            </div>
        </div> <!-- container-->
        <footer class="ss_footer" role="contentinfo">
            <div class="container">
                <div class="pull-right">
                    <img class="img-responsive logo" src="../img/logo.png" alt="Captivad" />
                </div>

                <p class="ss_back_to_top">Back to Top</p>

                <p>Designed and built by <a href="http://springsignage.com/">Spring Signage</a> for the <a href="http://www.xibo.org.uk" target="_blank">Xibo Project</a>.</p>
                <p>Open Source Code licensed under <a href="" target="_blank">GNU Affero General Public License v3 or later</a>, documentation under <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.0/uk/" target="_blank">Creative Commons Licence</a>.</p>

                <p class="ss_footer_links">Currently v1.8.4</p>

                <p class="ss_languages"><a href="../en/index.html">en</a> | <a href="../fr/index.html">fr</a></p>
            </div>
        </footer>

        <!-- JavaScript -->
        <script src="../vendor/jquery/jquery-1.9.1.js"></script>
        <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                $(".ss_body img").addClass("img-thumbnail");
                $(".ss_body table").addClass("table");

                // Set the selected page based on the TOC name
                // Mark the appropriate top nav element as the selected page
                $("#side-nav a").each(function() {
                    if ($(this).data().tocName == $("body").data().toc)
                        $(this).parent().addClass("active");
                });

                $(".ss_back_to_top").click(function() {
                    $('html, body').animate({scrollTop : 0},800);
                });

                if (inIframe()) {
                    console.log("In Frame");
                    $("#top-nav").css("display", "none");
                    $(".ss-sidebar").parent().css("display", "none");
                }
            });

            function inIframe () {
                try {
                    return window.self !== window.top;
                } catch (e) {
                    return true;
                }
            }
        </script>
    </body>
</html>
